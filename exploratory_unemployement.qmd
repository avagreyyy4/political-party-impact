---
title: "initial look"
editor: visual
---

```{r, message = FALSE}
library(readr)
library(dplyr)
library(tidyverse)
library(forcats)
library(tidytext)
library(scales)
library(lubridate)
library(stringr)
```

```{r}
unemployement <- read_csv("data/unemployement_rate_by_state.csv")
```

There are 16 states that voted blue in every presidential election since 2000, and there are 20 states that have voted red in every presidential election since 2000. 
```{r}
consistent_blue <- c("California", "Oregon", "Washington", "Minnesota", "Illinois", "New York", "Vermont", "New Jersey", "Maine", "Rhode Island", "Maryland", "Delaware", "District of Columbia", "Conneticut", "Hawaii", "Massachusetts")

consistent_red <- c("Alaska", "Alabama", "Arkansas", "Idaho", "Kansas", "Kentucky", "Louisiana", "Missouri", "Mississippi", "Montana", "Nebraska", "North Dakota", "Oklahoma", "South Carolina", "South Dakota", "Tennesse", "Texas", "Utah", "Wyoming", "West Virginia")

all_consistent <- union(consistent_blue, consistent_red)
```

```{r}
unemployement <- unemployement |> filter(
  State %in% all_consistent)
```

```{r}
biden <- unemployement |> mutate(difference = `2024` - `2021`,
                                 average = (`2024` + `2023` + `2022` + `2021`)/4) |> pivot_longer(cols = c(`2024`,`2021`), names_to = "year", values_to = "value") |>
  mutate(Vote = case_when(
    State %in% consistent_red ~ "Republican",
    State %in% consistent_blue ~ "Democrat",
    State == 'United States' ~ "United States")) |> select(State, difference, average, Vote) |> mutate(Administration = "Biden") |> distinct()

trump <- unemployement |> mutate(difference = `2020` - `2017`,
                                 average = (`2020` + `2019` + `2018` + `2017`)/4) |> pivot_longer(cols = c(`2020`,`2017`), names_to = "year", values_to = "value") |>
  mutate(Vote = case_when(
    State %in% consistent_red ~ "Republican",
    State %in% consistent_blue ~ "Democrat",
    State == 'United States' ~ "United States")) |> select(State, difference, average, Vote) |> mutate(Administration = "Trump") |> distinct()

obama <- unemployement |> mutate(difference = `2016` - `2009`,
                                 average = (`2016` + `2015` + `2014` + `2013`+`2012` + `2011` + `2010` + `2009`)/8) |> pivot_longer(cols = c(`2016`,`2009`), names_to = "year", values_to = "value") |>
  mutate(Vote = case_when(
    State %in% consistent_red ~ "Republican",
    State %in% consistent_blue ~ "Democrat",
    State == 'United States' ~ "United States")) |> select(State, difference, average, Vote) |> mutate(Administration = "Obama") |> distinct()

bush <- unemployement |> mutate(difference = `2008` - `2001`,
                                 average = (`2008` + `2007` + `2006` + `2005`+`2004` + `2003` + `2002` + `2001`)/8) |> pivot_longer(cols = c(`2008`,`2001`), names_to = "year", values_to = "value") |>
  mutate(Vote = case_when(
    State %in% consistent_red ~ "Republican",
    State %in% consistent_blue ~ "Democrat",
    State == 'United States' ~ "United States")) |> select(State, difference, average, Vote) |> mutate(Administration = "Bush") |> distinct()
```

```{r}
#| fig.height: 15
total <- rbind(biden, bush, obama, trump)

total <- total |>
  mutate(Administration = factor(
    Administration,
    levels = c("Bush", "Obama", "Trump", "Biden")  
  )) |> mutate(State_in_panel = reorder_within(State, average, Administration))

total |> ggplot(aes(x = average, y = State_in_panel, color = Vote)) + geom_point() +
  facet_wrap(~Administration, scales = "free_y") + scale_color_manual(
    values = c(
      "Republican" = "red",
      "Democrat"   = "blue",
      "United States" = "gray"
    )) + scale_y_reordered() + labs(y = "State", x = "Average Unemployement Rate",
                                    title = "Average Unemployement Rate Throughout 21st Century Administrations")

```

```{r}
#| fig.height: 15

total2 <- total |>
  mutate(Administration = factor(
    Administration,
    levels = c("Bush", "Obama", "Trump", "Biden")  
  )) |> mutate(State_in_panel = reorder_within(State, difference, Administration))

total2 |> ggplot(aes(x = difference, y = State_in_panel, color = Vote)) + geom_point() +
  facet_wrap(~Administration, scales = "free_y") + scale_color_manual(
    values = c(
      "Republican" = "red",
      "Democrat"   = "blue",
      "United States" = "gray"
    )) + scale_y_reordered() + labs(y = "State", x = "Difference in Unemployement",
                                    title = "Difference in Unemployement Throughout 21st Century Administrations", caption = "Difference calculated as last year in office minus first year in office (smaller values show decline in unemployement throughout years)")
```

```{r}

safe_red_always <- c(
  "Alabama","Alaska","Arkansas","Idaho","Kansas","Kentucky","Louisiana",
  "Mississippi","Missouri","Montana","Nebraska","North Dakota","Oklahoma",
  "South Carolina","South Dakota","Tennessee","Texas","Utah","West Virginia","Wyoming"
)

always_blue <- c(
  "California","Connecticut","Delaware","Hawaii","Illinois","Maine",
  "Maryland","Massachusetts","Minnesota","New Jersey","New York",
  "Oregon","Rhode Island","Vermont","Washington"
)

red_every_election <- unemployement |> filter(State %in% safe_red_always) |> 
  pivot_longer(cols = `2024`:`2000`, names_to = "year", values_to = "value") |>
  mutate(Party = "Republican")

red_every_election$year <- as.Date(red_every_election$year, format = "%Y")

blue_every_election <- unemployement |> filter(State %in% always_blue) |>
  pivot_longer(cols = `2024`:`2000`, names_to = "year", values_to = "value") |>
  mutate(Party = "Democratic") 

blue_every_election$year <- as.Date(blue_every_election$year, format = "%Y") 


blue_every_election <- blue_every_election |> 
  mutate(year = floor_date(year, unit = "year")) 


red_every_election <- red_every_election |> 
  mutate(year = floor_date(year, unit = "year"))
```

```{r}
ggplot() +
  geom_line(data = blue_every_election,
            aes(x = year, y = value, group = State),
            alpha = 0.5, color = "blue") +

  labs(title = "U.S. Unemployement Rates", x = NULL, y = "Rate") +
  theme_grey(base_size = 16) +
  theme(legend.position = "none") +
  scale_x_date(
  limits = as.Date(c("2000-01-01", "2024-12-31")),
  date_breaks = "4 years",
  date_labels = "%Y",
  expand = c(0, 0)   
)

```

```{r}
ggplot() +
  geom_line(data = red_every_election,
            aes(x = year, y = value, group = State),
            alpha = 0.5, color = "red") +

  labs(title = "U.S. Unemployement Rates", x = NULL, y = "Rate") +
  theme_grey(base_size = 16) +
  theme(legend.position = "none") +
  scale_x_date(
  limits = as.Date(c("2000-01-01", "2024-12-31")),
  date_breaks = "4 years",
  date_labels = "%Y",
  expand = c(0, 0)   
)

```



